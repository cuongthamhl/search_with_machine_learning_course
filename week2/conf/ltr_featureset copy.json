{
  "featureset": {
    "features": [
      {
        "name": "name_match",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match": {
            "name": "{{keywords}}"
          }
        }
      },
      {
        "name": "name_phrase_match",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match_phrase": {
            "name": "{{keywords}}"
          }
        }
      },
      {
        "name": "shortDescription",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match": {
            "shortDescription": { 
              "query": "{{keywords}}",
              "operator": "OR",
              "minimum_should_match": "2<75%"            
            }
          }
        }
      },
      {
        "name": "longDescription",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match": {
            "longDescription": {
              "query": "{{keywords}}",
              "operator": "OR",
              "minimum_should_match": "2<75%"
            }
          }          
        }
      },
      {
        "name": "features",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match": {
            "features": "{{keywords}}"
          }
        }
      },
      {
        "name": "features_phrase",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
          "match": {
            "features": {
              "query": "{{keywords}}",
              "operator": "OR",
              "minimum_should_match": "2<75%"  
            }
          }
        }
      },
      {
        "name": "classifications",
        "params": [
          "keywords"
        ],
        "template_language": "mustache",
        "template": {
         
              "multi_match": {
                "query": "{{keywords}}",
                "type": "phrase",
                "slop": "6",
                "minimum_should_match": "2<75%",
                "fields": [
                  "department",
                  "class",
                  "subclass"
                ]
              }
            }                  
      },
      {
        "name": "salePrice",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "salePrice",
                  "missing": 0
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      {
        "name": "regularPrice",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "regularPrice",
                  "missing": 0
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      {
        "name": "click_prior",
        "template_language": "mustache",
        "template": {
          "query_string": {
            "query": "{{click_prior_query}}",
            "fields": ["_id"]
          }
        }
      },
      {
        "name": "categoryExactMatch",
        "params": [
          "keywords_exact"
        ],
        "template_language": "mustache",
        "template": {          
            "match_phrase": {
                  "categoryPathExact": {
                      "query": "{{keywords_exact}}"
                  }
             }
          }        
      },
      {
        "name": "salesRankLongTerm",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "salesRankLongTerm",
                  "missing": 100000000,
                  "modifier": "reciprocal"
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      {
        "name": "salesRankMediumTerm",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "salesRankMediumTerm",
                  "missing": 100000000,
                  "modifier": "reciprocal"
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      {
        "name": "salesRankShortTerm",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "salesRankShortTerm",
                  "missing": 100000000,
                  "modifier": "reciprocal"
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      {
        "name": "bestSellingRank",
        "template_language": "mustache",
        "template": {
          "function_score": {
            "functions": [
              {
                "field_value_factor": {
                  "field": "bestSellingRank",
                  "missing": 100000000,
                  "modifier": "reciprocal"
                }
              }
            ],
            "query": {
              "match_all": {}
            }
          }
        }
      },
      
      {
        "name": "cls_tablet",
        "params": [],
        "template_language": "script_feature",
        "template": {
            "lang": "painless",
            "source": "\n                    if(params._source[\"class\"] != null && params._source[\"class\"][0].equalsIgnoreCase(params.param1)){\n                        return 1;\n                    } else {\n                        return 0;\n                    }\n                ",
            "params": {
              "param1": "tablet"
            }
        }
      }
    ]
  }
}